// ----------------------------------
// RSDK Project: Sonic 1/Sonic 2
// Script Description: CPZ Setup Object
// Script Author: Christian Whitehead/Simon Thomley
// Unpacked by Rubberduckycooly's script unpacker
// ----------------------------------

// Aliases
private alias 40 : TYPE_CPZSETUP

// Function declarations
reserve function CPZSetup_Function97
reserve function CPZSetup_InitSuperSonicPal
reserve function CPZSetup_InitSuperTailsPal
reserve function CPZSetup_InitSuperKnuxPal
reserve function CPZSetup_SpeedUpMusic
reserve function CPZSetup_SlowDownMusic

// Static Values
public value ZoneSetup_value33 = 0;
public value ZoneSetup_value35 = 0;
public value ZoneSetup_value36 = 0;

private alias ZoneSetup_value35 : CPZSetup_AchieveCollected
private alias ZoneSetup_value36 : CPZSetup_TouchedWater




function CPZSetup_SpeedUpMusic
	CheckEqual(object[25].type, TypeName[Music Event])
	temp0 = checkResult
	CheckEqual(object[25].propertyValue, 2)
	temp0 &= checkResult
	CheckEqual(stage.musicFlag, 0)
	temp0 &= checkResult
	if temp0 == false
		switch music.currentTrack
		case 0
			SetMusicTrack("Invincibility_F.ogg", 2, 0x78B1)
			SwapMusicTrack("ChemicalPlant_F.ogg", 0, 0x85AFA, 0x1F40)
			break
		case 2
			SetMusicTrack("ChemicalPlant_F.ogg", 0, 0x85AFA)
			SwapMusicTrack("Invincibility_F.ogg", 2, 0x78B1, 0x1F40)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("ChemicalPlant_F.ogg", 0, 0x85AFA)
			SetMusicTrack("Invincibility_F.ogg", 2, 0x78B1)
			break
		end switch
	else
		stage.musicFlag = 1
	end if
end function


function CPZSetup_SlowDownMusic
	CheckEqual(object[25].type, TypeName[Music Event])
	temp0 = checkResult
	CheckEqual(object[25].propertyValue, 2)
	temp0 &= checkResult
	CheckEqual(stage.musicFlag, 0)
	temp0 &= checkResult
	if temp0 == false
		switch music.currentTrack
		case 0
			SetMusicTrack("Invincibility.ogg", 2, 0x9717)
			SwapMusicTrack("ChemicalPlant.ogg", 0, 0xA7224, 0x30D4)
			break
		case 2
			SetMusicTrack("ChemicalPlant.ogg", 0, 0xA7224)
			SwapMusicTrack("Invincibility.ogg", 2, 0x9717, 0x30D4)
			break
		case 4
		case 6
		case 7
			SetMusicTrack("ChemicalPlant.ogg", 0, 0xA7224)
			SetMusicTrack("Invincibility.ogg", 2, 0x9717)
			break
		end switch
	else
		stage.musicFlag = 2
	end if
end function


event ObjectMain

end event





event ObjectStartup

	LoadSpriteSheet("CPZ/Objects.gif")

	SetPaletteEntry(0, 192, 0)

	// Set the Chemical Plant music, and make it loop from sample 0xA7224
	SetMusicTrack("ChemicalPlant.ogg", 0, 0xA7224)
	SpeedUpMusic = CPZSetup_SpeedUpMusic
	SlowDownMusic = CPZSetup_SlowDownMusic

	// Sprite frames
	SpriteFrame(-16, 0, 32, 256, 224, 0)
	SpriteFrame(-16, 256, 32, 256, 224, 0)


	// Locky and Pocky are the ones swimming in these chemicals
	animalType1 = TypeName[Locky]
	animalType2 = TypeName[Pocky]

	// Set object 10 to be a CPZ Setup object
	object[10].type = TypeName[EMZ Setup]
	object[10].priority = PRIORITY_ACTIVE
	object[10].drawOrder = 0
	object[10].value2 = 496
	object[10].value18 = 1
	object[10].value19 = 2

	temp0 = screen.xcenter
	temp0 >>= 2
	object[10].value2 -= temp0


	// Load the eletric flash palette in case the player tries to swim with a lightning shield
	LoadPalette("ElectricFlash.act", 2, 0, 0, 256)


	arrayPos0 = 0
	while arrayPos0 < 576
		temp0 = arrayPos0
		temp0 &= 63
		arrayPos0++
	loop
end event

event RSDKDraw
	DrawSprite(0)
end event

event RSDKLoad
	LoadSpriteSheet("Global/Display.gif")
	SpriteFrame(-16, -16, 32, 32, 1, 143)
end event
